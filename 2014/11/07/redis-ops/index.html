<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>redis运维经验一二三 | HiDBA | 林晓嘉</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="本文主要介绍一些列简单的redis运维经验，帮助大家对redis的运维有个初步的了解，条目不分先后，后续还会持续添加。本文档预期读者为：redis使用者。
计算延迟时间
这里的延迟时间指的是指令请求的等待时间（单位为毫秒），包含网络延时以及单线程的命令等待，命令很简单：
1redis-cli --latency- history --i &lt;interval&gt; -h `host` -p">
<meta property="og:type" content="article">
<meta property="og:title" content="redis运维经验一二三">
<meta property="og:url" content="http://hidba.tk/2014/11/07/redis-ops/">
<meta property="og:site_name" content="HiDBA | 林晓嘉">
<meta property="og:description" content="本文主要介绍一些列简单的redis运维经验，帮助大家对redis的运维有个初步的了解，条目不分先后，后续还会持续添加。本文档预期读者为：redis使用者。
计算延迟时间
这里的延迟时间指的是指令请求的等待时间（单位为毫秒），包含网络延时以及单线程的命令等待，命令很简单：
1redis-cli --latency- history --i &lt;interval&gt; -h `host` -p">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="redis运维经验一二三">
<meta name="twitter:description" content="本文主要介绍一些列简单的redis运维经验，帮助大家对redis的运维有个初步的了解，条目不分先后，后续还会持续添加。本文档预期读者为：redis使用者。
计算延迟时间
这里的延迟时间指的是指令请求的等待时间（单位为毫秒），包含网络延时以及单线程的命令等待，命令很简单：
1redis-cli --latency- history --i &lt;interval&gt; -h `host` -p">

  
    <link rel="alternative" href="/atom.xml" title="HiDBA | 林晓嘉" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <script src="http://libs.baidu.com/jquery/1.9.0/jquery.js"></script>
  
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F3693cef63e2b72be16ac8ddde570e37d' type='text/javascript'%3E%3C/script%3E"));
</script>

</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<div class="profilepic">
			<img src="http://image-myrock-github-io.qiniudn.com/head.jpg">
		</div>

		<hgroup>
		  <h1 class="header-author"><a href="/">林晓嘉</a></h1>
		</hgroup>

		
		<p class="header-subtitle">Technology change our life.</p>
		

		
			<div class="onoffswitch">
			    <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" checked>
			    <label class="onoffswitch-label" for="myonoffswitch">
			        <span class="onoffswitch-inner"></span>
			        <span class="onoffswitch-switch"></span>
			    </label>
			</div>
		

		<div class="switch-area">
			<section class="first-part">
				<nav class="header-menu">
					<ul>
					
						<li><a href="/">HOME</a></li>
			        
						<li><a href="/archives">ARCHIVES</a></li>
			        
						<li><a href="/aboutme">ABOUT</a></li>
			        
					</ul>
				</nav>
				<nav class="header-nav">
					<div class="social">
						
							<a class="github" target="_blank" href="https://github.com/myrock/myrock.github.io" title="github">github</a>
				        
							<a class="weibo" target="_blank" href="http://weibo.com/u/1735228455" title="weibo">weibo</a>
				        
					</div>
				</nav>
			</section>
			
			
			<section class="second-part">
				<div class="widget tagcloud">
					<a href="/tags/MySQL/" style="font-size: 20.00px;">MySQL</a><a href="/tags/NoSQL/" style="font-size: 10.00px;">NoSQL</a><a href="/tags/Redis/" style="font-size: 10.00px;">Redis</a><a href="/tags/SQL优化/" style="font-size: 15.00px;">SQL优化</a><a href="/tags/database/" style="font-size: 20.00px;">database</a><a href="/tags/ops/" style="font-size: 10.00px;">ops</a><a href="/tags/other/" style="font-size: 10.00px;">other</a>
				</div>
			</section>
			
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay"></div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="http://image-myrock-github-io.qiniudn.com/head.jpg">
			</div>

			<hgroup>
			  <h1 class="header-author"><a href="/">林晓嘉</a></h1>
			</hgroup>
			
			<p class="header-subtitle">Technology change our life.</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">HOME</a></li>
		        
					<li><a href="/archives">ARCHIVES</a></li>
		        
					<li><a href="/aboutme">ABOUT</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/myrock/myrock.github.io" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/u/1735228455" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <article id="post-redis-ops" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/11/07/redis-ops/" class="article-date">
  	<time datetime="2014-11-07T09:07:15.000Z" itemprop="datePublished">11月 7 2014</time>
</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NoSQL/">NoSQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Redis/">Redis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ops/">ops</a></li></ul>

    </div>
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      redis运维经验一二三
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文主要介绍一些列简单的redis运维经验，帮助大家对redis的运维有个初步的了解，条目不分先后，后续还会持续添加。本文档预期读者为：redis使用者。</p>
<h2 id="计算延迟时间">计算延迟时间</h2>
<p>这里的延迟时间指的是指令请求的等待时间（单位为毫秒），包含网络延时以及单线程的命令等待，命令很简单：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">redis-cli --latency- history --i &lt;interval&gt;</span> -h `host` -p `port`</span></div></pre></td></tr></table></figure>

<p>这里我们来测试下<br><strong>场景1：本地空闲的redis实例，延时几乎为0</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@lxj tmp]<span class="preprocessor"># /usr/local/redis/bin/redis-cli --latency-history -i 5 -h 10.59.xx.xx -p 6379</span></div><div class="line"><span class="built_in">min</span>: <span class="number">0</span>, <span class="built_in">max</span>: <span class="number">1</span>, avg: <span class="number">0.00</span> (<span class="number">455</span> samples) -- <span class="number">5.01</span> seconds range</div><div class="line"><span class="built_in">min</span>: <span class="number">0</span>, <span class="built_in">max</span>: <span class="number">0</span>, avg: <span class="number">0.00</span> (<span class="number">423</span> samples) -- <span class="number">5.00</span> seconds range</div><div class="line"><span class="built_in">min</span>: <span class="number">0</span>, <span class="built_in">max</span>: <span class="number">1</span>, avg: <span class="number">0.00</span> (<span class="number">455</span> samples) -- <span class="number">5.01</span> seconds range</div><div class="line"><span class="built_in">min</span>: <span class="number">0</span>, <span class="built_in">max</span>: <span class="number">1</span>, avg: <span class="number">0.28</span> (<span class="number">455</span> samples) -- <span class="number">5.01</span> seconds range</div></pre></td></tr></table></figure>

<a id="more"></a>

<p><strong>场景2：模拟网络延时严重的场景（client），由于客户端出口带宽被打满，导致请求延时，平均在30毫秒+</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root<span class="variable">@lxj</span> ~]# /usr/local/redis/bin/redis-cli --latency-history -i <span class="number">5</span> -h <span class="number">10.59</span>.xx.xx -p <span class="number">20010</span> -a <span class="string">'xxxxx'</span></div><div class="line"><span class="keyword">min</span>: <span class="number">9</span>, <span class="keyword">max</span>: <span class="number">640</span>, avg: <span class="number">48.21</span> (<span class="number">87</span> samples) -- <span class="number">5.17</span> seconds range</div><div class="line"><span class="keyword">min</span>: <span class="number">9</span>, <span class="keyword">max</span>: <span class="number">639</span>, avg: <span class="number">38.48</span> (<span class="number">101</span> samples) -- <span class="number">5.02</span> seconds range</div><div class="line"><span class="keyword">min</span>: <span class="number">9</span>, <span class="keyword">max</span>: <span class="number">1472</span>, avg: <span class="number">54.92</span> (<span class="number">78</span> samples) -- <span class="number">5.14</span> seconds range</div><div class="line"><span class="keyword">min</span>: <span class="number">9</span>, <span class="keyword">max</span>: <span class="number">219</span>, avg: <span class="number">26.30</span> (<span class="number">135</span> samples) -- <span class="number">5.01</span> seconds range</div><div class="line"><span class="keyword">min</span>: <span class="number">9</span>, <span class="keyword">max</span>: <span class="number">637</span>, avg: <span class="number">30.42</span> (<span class="number">119</span> samples) -- <span class="number">5.01</span> seconds range</div><div class="line"><span class="keyword">min</span>: <span class="number">9</span>, <span class="keyword">max</span>: <span class="number">639</span>, avg: <span class="number">21.83</span> (<span class="number">150</span> samples) -- <span class="number">5.01</span> seconds range</div><div class="line"><span class="keyword">min</span>: <span class="number">9</span>, <span class="keyword">max</span>: <span class="number">636</span>, avg: <span class="number">45.84</span> (<span class="number">91</span> samples) -- <span class="number">5.20</span> seconds range</div></pre></td></tr></table></figure>

<p><strong>场景3：生产redis实例1，该实例平均延时较高，很多时候平均延时几乎到1毫秒，最大延时到了13毫秒，这样的请求跟负载注定实例的qps以及吞吐量不会高</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root<span class="variable">@lxj</span> ~]# /usr/local/redis/bin/redis-cli --latency-history -i <span class="number">5</span> -h <span class="number">10.59</span>.xx.xx -p <span class="number">20010</span> -a <span class="string">'xxxxx'</span></div><div class="line"><span class="keyword">min</span>: <span class="number">1</span>, <span class="keyword">max</span>: <span class="number">2</span>, avg: <span class="number">1.03</span> (<span class="number">453</span> samples) -- <span class="number">5.01</span> seconds range</div><div class="line"><span class="keyword">min</span>: <span class="number">0</span>, <span class="keyword">max</span>: <span class="number">1</span>, avg: <span class="number">1.00</span> (<span class="number">445</span> samples) -- <span class="number">5.01</span> seconds range</div><div class="line"><span class="keyword">min</span>: <span class="number">0</span>, <span class="keyword">max</span>: <span class="number">1</span>, avg: <span class="number">0.98</span> (<span class="number">417</span> samples) -- <span class="number">5.00</span> seconds range</div><div class="line"><span class="keyword">min</span>: <span class="number">0</span>, <span class="keyword">max</span>: <span class="number">2</span>, avg: <span class="number">0.96</span> (<span class="number">422</span> samples) -- <span class="number">5.01</span> seconds range</div><div class="line"><span class="keyword">min</span>: <span class="number">0</span>, <span class="keyword">max</span>: <span class="number">13</span>, avg: <span class="number">0.81</span> (<span class="number">448</span> samples) -- <span class="number">5.00</span> seconds range</div><div class="line"><span class="keyword">min</span>: <span class="number">0</span>, <span class="keyword">max</span>: <span class="number">2</span>, avg: <span class="number">0.49</span> (<span class="number">447</span> samples) -- <span class="number">5.01</span> seconds range</div><div class="line"><span class="keyword">min</span>: <span class="number">0</span>, <span class="keyword">max</span>: <span class="number">2</span>, avg: <span class="number">0.17</span> (<span class="number">418</span> samples) -- <span class="number">5.00</span> seconds range</div><div class="line"><span class="keyword">min</span>: <span class="number">0</span>, <span class="keyword">max</span>: <span class="number">1</span>, avg: <span class="number">0.12</span> (<span class="number">418</span> samples) -- <span class="number">5.01</span> seconds range</div></pre></td></tr></table></figure>

<p><strong>场景4：生产redis实例2，该实例比起实例1平均延时较低，平均延时在0.01~0.13毫秒，算是比较健康的实例</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root<span class="variable">@lxj</span> tmp]# /usr/local/redis/bin/redis-cli --latency-history -i <span class="number">5</span> -h <span class="number">10.59</span>.xx.xx -p <span class="number">6379</span> -a <span class="string">'xxxx'</span></div><div class="line"><span class="keyword">min</span>: <span class="number">0</span>, <span class="keyword">max</span>: <span class="number">2</span>, avg: <span class="number">0.13</span> (<span class="number">418</span> samples) -- <span class="number">5.01</span> seconds range</div><div class="line"><span class="keyword">min</span>: <span class="number">0</span>, <span class="keyword">max</span>: <span class="number">1</span>, avg: <span class="number">0.03</span> (<span class="number">443</span> samples) -- <span class="number">5.00</span> seconds range</div><div class="line"><span class="keyword">min</span>: <span class="number">0</span>, <span class="keyword">max</span>: <span class="number">1</span>, avg: <span class="number">0.01</span> (<span class="number">454</span> samples) -- <span class="number">5.00</span> seconds range</div><div class="line"><span class="keyword">min</span>: <span class="number">0</span>, <span class="keyword">max</span>: <span class="number">1</span>, avg: <span class="number">0.01</span> (<span class="number">447</span> samples) -- <span class="number">5.01</span> seconds range</div><div class="line"><span class="keyword">min</span>: <span class="number">0</span>, <span class="keyword">max</span>: <span class="number">1</span>, avg: <span class="number">0.00</span> (<span class="number">418</span> samples) -- <span class="number">5.01</span> seconds range</div></pre></td></tr></table></figure>

<h2 id="注意产生的流量">注意产生的流量</h2>
<p>很多时候我们也需要注意下redis服务器的流量负载情况，由于redis本身的高性能服务，我们的生产服务就出现过直接把服务器出口带宽打满的现象。这点只需要注意下即可，正常出现概率不高。</p>
<h2 id="注意请求的时间复杂度">注意请求的时间复杂度</h2>
<p>时间复杂度是指redis指令执行的时间复杂度，从O(1)到O(N)甚至更复杂不等。我们建议将一些复杂度O(N)甚至是更复杂的操作，比如：排序，多键操作等等指令转化或者是放在redis slave上，达到效率提升的目的，说白了有点读写分离的意思。</p>
<blockquote>
<p>案例1：某项目推送模块的redis优化，其中有一个是：将复杂度为O(log(N)+M)的ZREVRANGE操作转换为list的O(1)操作，qps从5000上升到6500。</p>
<p>案例2：某项目的一个在线用户统计模块，包含了大量的keys的遍历操作（大约6%的请求占了90%+的请求时间），导致redis吞吐大大降低，取消掉keys操作以后，吞吐量开始回升。</p>
</blockquote>
<p>而这些信息我们可以通过一个redis-faina.py的脚本或获取redis的运行状态以及信息，从中我们可以发现一些优化点，具体信息见下。</p>
<p><strong><em>注意事项1：该脚本运行环境为python2.7，当监控redis2.4的实例时需要加上—redis-version=2.4的参数。</em></strong><br><strong><em>注意事项2：该脚本的的执行统计时长不是绝对准确，在繁忙的环境下可以作为参考，在限时数据不尽准确（执行时长是以两个指令开始执行的时间差作为第一个指令执行的时长，其中可能包含空闲等待的时间）。</em></strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">[root@lxj tmp]# redis-cli -h 10.59.xx.xx -p 20010 -a <span class="emphasis">'xxxxx'</span> MONITOR |head -n 10000 | python 1.py  head –n // xxxx是取样xxxx次请求的意思        </div><div class="line"><span class="header">Overall Stats</span></div><div class="line">========================================</div><div class="line">Lines Processed         10000</div><div class="line"><span class="header">Commands/Sec            2125.30 //QPS一个很重要的性能指标</span></div><div class="line">--------------------------------------------------------------------</div><div class="line"><span class="header">Top Prefixes</span></div><div class="line">========================================</div><div class="line"><span class="header">push    8067    (80.67%)</span></div><div class="line">--------------------------------------------------------------------</div><div class="line"><span class="header">Top Keys //请求最多的KEY</span></div><div class="line">========================================</div><div class="line">4474d2d3406340ccb39e4cb7103f5a79        1932    (19.32%)</div><div class="line">push:onlinedevice:3:1                   1930    (19.30%)</div><div class="line">push:messagelist:android:3              1620    (16.20%)</div><div class="line">push:onlineuser:3:1                     321     (3.21%)</div><div class="line">push:user:3:1:166457                    4       (0.04%)</div><div class="line">push:user:3:1:69651                     4       (0.04%)</div><div class="line">push:user:3:1:145696                    4       (0.04%)</div><div class="line"><span class="header">push:user:3:1:188873                    4       (0.04%)</span></div><div class="line">--------------------------------------------------------------------</div><div class="line"><span class="header">Top Commands //请求最多的指令</span></div><div class="line">========================================</div><div class="line">ZADD            2252    (22.52%)</div><div class="line">AUTH            1932    (19.32%)</div><div class="line">SETEX           1930    (19.30%)</div><div class="line">LPOP            1621    (16.21%)</div><div class="line">LRANGE          1620    (16.20%)</div><div class="line">SADD            321     (3.21%)</div><div class="line">EXPIRE          321     (3.21%)</div><div class="line"><span class="header">SET             2       (0.02%)</span></div><div class="line">--------------------------------------------------------------------</div><div class="line"><span class="header">Command Time (microsecs) //响应时间的正态分布</span></div><div class="line">========================================</div><div class="line">Median          167.75</div><div class="line">75%             349.75</div><div class="line">90%             1109.0</div><div class="line"><span class="header">99%             5474.25</span></div><div class="line">--------------------------------------------------------------------</div><div class="line"><span class="header">Heaviest Commands (microsecs) //指令的总体耗时</span></div><div class="line">========================================</div><div class="line">LRANGE          2370628.25</div><div class="line">SETEX           1413046.0</div><div class="line">AUTH            472047.75</div><div class="line">LPOP            281701.75</div><div class="line">ZADD            153476.25</div><div class="line">SADD            7956.75</div><div class="line">EXPIRE          5963.75</div><div class="line"><span class="header">SET             388.5</span></div><div class="line">--------------------------------------------------------------------</div><div class="line"><span class="header">Slowest Calls //慢查询</span></div><div class="line">========================================</div><div class="line">17460.25        "LRANGE" "push:messagelist:android:3" "0" "-1"</div><div class="line">16738.25        "SETEX" "push:detail:3:1:be461ce1a982c30771b0fa90496fd492" "1800" "a:2:{s:6:\"app<span class="emphasis">_id\";i:3;s:11:\"device_</span>type\";s:1:\"1\";}"</div><div class="line">16026.0         "LRANGE" "push:messagelist:android:3" "0" "-1"</div><div class="line">15986.0         "LRANGE" "push:messagelist:android:3" "0" "-1"</div><div class="line">15124.0         "LRANGE" "push:messagelist:android:3" "0" "-1"</div><div class="line">14983.75        "LRANGE" "push:messagelist:android:3" "0" "-1"</div><div class="line">13885.0         "LRANGE" "push:messagelist:android:3" "0" "-1"</div><div class="line">13792.0         "LRANGE" "push:messagelist:android:3" "0" "-1"</div></pre></td></tr></table></figure>

<h2 id="不必要的操作">不必要的操作</h2>
<p>不需要的操作是指类型一些EXISTS、DEL这样的操作，在很多场景下是完全没有必要的，在QPS不变的情况下，取消这些不必要的请求可以达到提升有效用户请求的数量。</p>
<blockquote>
<p>案例1：XX项目点播业务的redis实例，平均约存在37.34%的EXISTS请求，而EXISTS是用在每次对key做操作(GET,ZRANGE ,HMGET…)前都执行，用于判断该key是否存在，其实redis这些api对于不存在的key都会返回提示，因此可以直接取消EXISTS的请求，在QPS不变的情况下，有效用户请求可以提升约37.34%。</p>
<p>案例2：XX项目推送业务的redis实例中存在25.5%的DEL操作，占据约40%的请求时间，后将key直接设置过期时间，在同样的QPS下，用户有效请求得到提升。<br>但是并不代表EXISTS、DEL这类型的操作都是不必要的请求，具体案例还需具体分析，存在必有其道理。</p>
</blockquote>
<h2 id="管道操作">管道操作</h2>
<p>Redis提供一个pipeline的管道操作模式，将多个指令汇总到队列中批量执行，可以减少tcp交互产生的时间，一般情况下能够有10%~30%不等的性能提升。<br>但是需要注意的是，pipeline与multi不同，无法保证请求之间的原子性，因此需要考虑使用场景。如果业务场景允许，这也是一个性能提升的点。</p>
<h2 id="IO优化">IO优化</h2>
<p>IO优化主要是redis快照或者aof产生的，目前我们的生产实例并未开始aof（2.8的aof性能还在测试中），一般我们需要根据redis中上数据的重要程度来设置快照频率，或者是快照只在slave上发生。</p>
<h2 id="注意CPU使用率">注意CPU使用率</h2>
<p>Redis是单线程作业，因此需要注意CPU使用率，除了分离业务，读写分离以外，twemproxy也能有效的提升redis的CPU利用率。</p>

      
    </div>
    <footer class="article-footer">
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2014/10/29/rand-query/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">[MySQL SQL优化系列]之如何高效获取随机数据</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="redis-ops" data-title="redis运维经验一二三" data-url="http://hidba.tk/2014/11/07/redis-ops/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"HiDBA"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-right">
    		&copy; 2014 林晓嘉
    	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>

  <script src="/js/main.js" type="text/javascript"></script>


  </div>
</body>
</html>